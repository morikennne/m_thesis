
\chapter{Miss-assuming Pipeline (MAP)}
\label{sec:miss_assumed_pipeline}
本章では，提案手法の一つであるMAPについて説明する．まず，\refsec{map_abstract}でMAPの概要を述べた後，\refsec{map_structure}でMAPの構造を示す．その後，\refsec{map_different}で MAP の動作を従来のパイプラインと比較しながら示し，\refsec{tradeoff}で従来のパイプラインに対するトレードオフについて述べる．

\section{概要}
\label{sec:map_abstract}

本研究では，命令キャッシュ・ミスによる性能低下を抑制するために，Miss-assuming Pipeline (MAP)という新しい命令フェッチのパイプライン構造を提案する．従来のプロセッサは，命令キャッシュ・アクセス時に，キャッシュがヒットすることを前提としてパイプラインが設計されている．これに対し，MAP は命令キャッシュ・アクセス時にキャッシュ・ミスが発生することを前提としてパイプラインが設計されている．このことを\fig{pipeline}を用いて説明する．同図はプロセッサのパイプライン・ステージを図示したものであり，L1, L2，ID，EX, WB はそれぞれ L1 キャッシュ・アクセス，L2 キャッシュ・アクセス，デコード，実行，ライトバック・ステージを表しており，NOP は何もしない（no-operation）で命令を次のステージに渡すステージを表している．なお，説明を簡単にするために，本論文の説明では L1 キャッシュのレイテンシを 1 サイクル，L2 キャッシュのレイテンシを 2 サイクルと仮定する．また，L2 キャッシュは必ずキャッシュ・ヒットすると仮定する．

まず，従来のパイプラインの動作について説明する．従来のパイプラインでは，命令キャッシュがヒットした場合，\subfig{pipeline}{hap_pipeline}の上側に示すように命令が得られると即座にその命令をデコード・ステージへ送る．一方，命令キャッシュがミスした場合は，L2 キャッシュへのアクセスが必要になるため，\subfig{pipeline}{hap_pipeline}の下側に示すように L1 キャッシュ・アクセス後に 2 サイクルかけて L2 キャッシュ・アクセスを行い，得られた命令をデコード・ステージへ送る．

これに対し，MAP では，命令キャッシュがヒットした場合でも，得られた命令を即座にデコード・ステージへ送らず，L2 キャッシュのレイテンシと同じ数の NOP ステージを経由してから命令をデコード・ステージへ送る．これは，命令キャッシュがヒットしてもミスしても，命令をデコード・ステージに送るタイミングを同じにするためである．詳細は\refsec{map_different}で述べるが，この動作により MAP は命令キャッシュ・ミスが発生してもパイプラインの乱れが生じず，性能が低下しないという特徴を持つ．命令キャッシュがミスした場合の動作は，従来のパイプラインと同じである．

なお，命令キャッシュのミスを前提としている MAP に対し，従来のパイプラインは命令キャッシュのヒットを前提としているため，本論文では以降，従来のパイプラインのことを MAP と対比して Hit-assuming Pipeline (HAP) と呼ぶ．

% 図を使う例: figure 環境を使用

% \begin{figure}[tb]
%   \centering
%   \includegraphics[scale=.5]{hoge.eps}
%   \caption{例１}
%   \label{fig:hoge}
% \end{figure}



% 副図を使う例: minipage と subcaption を使用

% \begin{figure}[tb]
%   \begin{minipage}[htb]{1\hsize}
%     \centering 
%     \includegraphics[keepaspectratio, scale=0.8]{hap_pipeline.eps}
%     \vspace{.3cm} % <-- vspace で縦方向の位置を調節できる
%     \subcaption{従来のパイプライン (HAP: Hit-Assuming Pipeline)}
%     \label{fig:hap_pipeline}
%   \end{minipage}
%   \begin{minipage}[htb]{.97\hsize}
%     \vspace{1.3cm}
%     \centering
%     \includegraphics[keepaspectratio, scale=0.8]{map_pipeline.eps}
%     \vspace{.3cm}
%     \subcaption{MAP: Miss-Assuming Pipeline}
%     \label{fig:map_pipeline}
%   \end{minipage}
%   \vspace{.8cm}
%   \caption{各パイプラインの命令処理工程}
%   \label{fig:pipeline}
% \end{figure}


